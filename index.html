<!doctype html>
<html lang='en'>
  <head>
    <!-- Required meta tags -->
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no'>

    <!-- Bootstrap CSS -->
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css' integrity='sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2' crossorigin='anonymous'>

    <title></title>
    <style>
        /* body {
            background-color: #2F4F4F;
            color: lightgoldenrodyellow;
        }
        
        a, a:hover, a:visited {
            color: lightgoldenrodyellow;
            font-weight: bold;
        } */

        .js-error {
            color: lightsalmon;
            display: none;
        }


    </style>


 </head>

 <body>
        <div style="display: none;">
            <h1>Fetch Weather Data</h1>
            <ul>
                <li>Fetch weather data from at-wetter.tk: temperature and air pressure from vienna</li>
                <li>do it for a certain day and time</li>
                <li>UI</li>
                <ul>
                    <li>create a user interface where a date and time can be set</li>
                    <ul><li>add in a NOW button</li></ul>
                    <li>add additional data fields for gestank Log</li>
                    <li>put the data out</li>
                    <ul><li>as a graph</li></ul>
                </ul>
            </ul>
        </div>
    
        <div class="container">
            <div class="row text-center py-5">
                <div class="col">
                    <h1><span class="js-loc">Wien Hohe Warte</span>, <span class="js-date">Datum</span></h1>
                </div>
            </div>

            <div class="row js-error text-center">
                <div class="col">
                    <h3>Sorry, no data found</h3>
                    <p>Weather records go back to 2014-07-26</p>
                    <!-- <p>Please make sure you use the correct date format: YYYY-MM-DD</p> -->
                </div>
            </div>

            <!-- <div class="row">

                <div class="col">
                    <h6>Temperature Data</h6>
                    <ul class="tempLi list-unstyled"></ul>
                </div>
                <div class="col">
                    <h6>Atmospheric Pressure Data (Station Level)</h6>
                    <ul class="pressLi list-unstyled">
                    </ul>
                </div>
                <div class="col">
                    <h6>Relative Humidity Data</h6>
                    <ul class="humLi list-unstyled">
                    </ul>
                </div>
            </div> -->
            
    
        

            <div class="row text-center py-5">
                <div class="col">
                    <div class="form-group">
                    <label for="date" class="form-control-lg">Select a date</label>
                    <input type="date" id="date" class="form-control-lg js-date-sel" value="">
                    <button type="submit" id="date-input" class="form-control-lg">Check</button>
                </div>
                </div>
            </div>

        
       
        <div class="row p-5">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">Date</th>
                        <th scope="col">Time</th>
                        <th scope="col">Â°C</th>
                        <th scope="col">Pressure</th>
                        <th scope="col">Humidity</th>
                    </tr>
                </thead>
                <tbody class="js-table">
                    <!-- data goes here -->
                </tbody>
            </table>
        </div>

        <div class="row js-error text-center">
            <div class="col">
                <h3>Sorry, no data found</h3>
                <p>Weather records go back to 2014-07-26</p>
                <!-- <p>Please make sure you use the correct date format: YYYY-MM-DD</p> -->
            </div>
        </div>

        <div class="row">
            <div class="col text-center">Data is fetched from <a href="http://at-wetter.tk/">http://at-wetter.tk/</a> - thx to Thomas Mitschke!</div>
        </div>

    </div>

        <script>
                    var dateInput = document.querySelector(".js-date-sel")
                    var dateSubmit = document.querySelector("#date-input")
                    console.log(dateInput.value)

                    dateSubmit.addEventListener('click', function(event){
                        console.log(dateInput.value)
                        date = dateInput.value
                        jsDate.innerText = date;
                        clearTable();
                        dataFetch();
                    })

                   // console.log()
                    //dateSel.addEventListener('')
    


                    // help found here:
                    // https://stackoverflow.com/questions/43871637/no-access-control-allow-origin-header-is-present-on-the-requested-resource-whe
                    
                    var jsDate = document.querySelector(".js-date")
    
                    //var date = String(prompt("Please enter a date (YYYY-MM-DD)", "2020-07-08"))
                     //var date = "2020-11-29"

                    //jsDate.innerText = date;

                    
                    var errorMsg = document.querySelector(".js-error")
                    var dataTable = document.querySelector(".js-table")
    
                    function clearTable(){
                        dataTable.innerHTML = " "
                    }
                    function dataFetch(){
                        console.log("Loading data from", date) 
                        const proxyurl = "https://cors-anywhere.herokuapp.com/";
                        let url = `http://at-wetter.tk/api/v1/station/11036/all/${date}/";`
                        fetch(proxyurl + url) // https://cors-anywhere.herokuapp.com/https://example.com
                            .then(response => response.text())
                            .then(fetchedData => {
                                if(fetchedData.length === 0 ) {
                                    console.warn("Too bad, no data was found")
                                    errorMsg.style.display = "inline";
                                }
                                //Split the csv into rows
                                const rows = fetchedData.split('\n');
                                //console.log(rows[0])
                                //console.log(rows[1])

                                for(i = 1; i <=24; i++) {
                                        const singleRow = rows[i].split("';'") //splits every row into each of the ';' separated values
                                        if(singleRow[1] != undefined) {    
                                            const date = singleRow[3] // takes the item 3 of the row: date
                                            const time = singleRow[4] // takes the item 4 of the row: time
                                            const temp = singleRow[5] // takes the item 5 of the row: the temp
                                            const pressure = singleRow[13] // takes the item 14 of the row: the pressure
                                            const humid = singleRow[7]

                                            dataTable.innerHTML = dataTable.innerHTML + `<tr>
                                                                    <td>${date}</td>
                                                                    <td>${time}</td>
                                                                    <td>${temp}</td>
                                                                    <td>${pressure}</td>
                                                                    <td>${humid}</td>
                                                                </tr>`
                                        }
                                    }
                                
                            })
                    };

                   //dataFetch();
    
            
        </script>



    <!-- Bootstrap & jQuery -->
        <script src='https://code.jquery.com/jquery-3.5.1.slim.min.js'
            integrity='sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj'
            crossorigin='anonymous'></script>
        
        <script src='https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js'
            integrity='sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx'
            crossorigin='anonymous'></script>
        
    <!-- BS End -->
 </body>
</html>